{% extends "main/base.html" %}
{% block content %}
 {% load box_extras %}

                  <!-- End 타이틀-->

                  <div class="container-fluid">
                      <!-- ============================================================== -->
                      <!-- Start Page Content -->
                      <!-- ============================================================== -->
                      <div class="row">
                              <div class="col-12 d-flex no-block align-items-center">

                                  <h4 class="page-title">안녕하세요 {{ user }}님, 같은 조의 멤버들과 결과 또는 진행상황을 보여줍니다</h4>
                                  <br>
                                   <p class="badge badge-dark" style="margin-top:5px;margin-left:20px;">현재 신용 크레딧 100</p>
                                   <form method="post" action="/main/box/{{user}}/search/">
                                       {% csrf_token %}
                                         <div class="input-group" style="margin-left:10px;margin-bottom:10px;" >


                                             <div class="input-group-prepend">
                                                 <span class="input-group-text" id="basic-addon1">파일 검색</span>
                                             </div>

                                             <input type="text" class="form-control" placeholder="파일을 찾습니다..입력후 엔터" aria-label="Username" aria-describedby="basic-addon1" name="search">


                                         </div>
                                 </form>
                                  <div class="ml-auto text-right" style="display:inline;">


                                      <nav aria-label="breadcrumb">
                                          <ol class="breadcrumb">
                                              <li class="breadcrumb-item"><a href="/main/box/{{user}}">내가 올린 파일</a></li>
                                              <li class="breadcrumb-item active" aria-current="page">파일공유 시스템</li>
                                          </ol>
                                      </nav>
                                  </div>
                              </div>
                      </div>
                      <div class="row">

                        {% if group %}
                      <div class="col-md-12">
                     <div class="card">
                         <div class="card-body">
                             <h5 class="card-title m-b-0">자신의 협업 상태를 팀원들에게 알려주세요.</h5>
                         </div>
                         <table class="table">
                             <thead>
                                 <tr>
                                     <th scope="col">나</th>
                                     <th scope="col">역할</th>
                                     <th scope="col">상태</th>
                                     <th scope="col">진행상황</th>
                                     <th scope="col">데드라인 (최초 입력후 변경불가)</th>
                                     <th scope="col">새로운 협업</th>
                                 </tr>
                             </thead>
                             <tbody>
                               <form method="post" action="/main/box/{{user}}/{{group}}/{{team}}/registertask/">
                                  {% csrf_token %}
                                 <tr>
                                    <td><input type="hidden" value="{{user}}" name="taskuser">{{user}}</td>
                                     <td>

                                       <div class="col-sm-9" >
                                         <input type="text" class="form-control" id="email1" placeholder="자신의 역할을 적어주세요." style="width: 120%;" name="taskname">
                                        </div>


                                     </td>
                                     <td class="text-success">


                                         <div class="col-md-9">
                                             <select class="select2 form-control custom-select" style="width: 120%; height:36px;" name="taskch">

                                                 <optgroup label="진행상황 선택 ">
                                                     <option value="A">아직 시작되지 않음</option>
                                                     <option value="B">현재 진행중</option>
                                                     <option value="C">완료</option>
                                                     <option value="D">파일 업로드 완료 </option>
                                                     <option value="E">진행 중단</option>
                                                     <option value="F">취소</option>
                                                 </optgroup>

                                             </select>
                                         </div>

                                     </td>

                                     <td>


                                                                                <div class="col-md-9">
                                                                                    <select class="select2 form-control custom-select" style="width: 100%; height:36px;" name="taskstatus">

                                                                                        <optgroup label="진행상황 선택 ">
                                                                                            <option value="0">0%</option>
                                                                                            <option value="10">10%</option>
                                                                                            <option value="15">15%</option>
                                                                                            <option value="20">20%</option>
                                                                                            <option value="25">25%</option>
                                                                                            <option value="30">30%</option>
                                                                                            <option value="35">35%</option>
                                                                                            <option value="40">40%</option>
                                                                                            <option value="45">45%</option>
                                                                                            <option value="50">50%</option>
                                                                                            <option value="55">55%</option>
                                                                                            <option value="60">60%</option>
                                                                                            <option value="65">65%</option>
                                                                                            <option value="70">70%</option>
                                                                                            <option value="75">75%</option>
                                                                                            <option value="80">80%</option>
                                                                                            <option value="85">85%</option>
                                                                                            <option value="90">90%</option>
                                                                                            <option value="95">95%</option>
                                                                                            <option value="100">100%</option>

                                                                                        </optgroup>

                                                                                    </select>
                                                                                </div>
                                     </td>

                                       <td>
                                         <div class="input-group">
                                              <input type="text" name="taskdate" class="form-control" id="datepicker-autoclose" placeholder="월/일/연도">
                                              <div class="input-group-append">
                                                  <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                              </div>
                                          </div>
                                         </td>
                                     <td>
                                      <button id="turnin" type="submit" style="display:inline;" class="btn btn-primary btn-sm">추가</button>
                                     </td>
                                 </tr>
                               </form>
                             </tbody>
                         </table>
                     </div>
                   </div>
                     {% endif %}

                          {% if group %}
                        <div class="col-md-12">
                       <div class="card">
                           <div class="card-body">
                               <h5 class="card-title m-b-0">현재 협업 상황 - 진행상황을 팀원들이 볼 수 있도록 업데이트 해주세요 </h5>
                           </div>
                           <table class="table">
                               <thead>
                                   <tr>
                                       <th scope="col">팀원</th>
                                       <th scope="col">역할</th>
                                       <th scope="col">상태</th>
                                       <th scope="col">데드라인</th>
                                       <th scope="col">진행상황</th>
                                       <th scope="col">업데이트</th>
                                   </tr>
                               </thead>
                               <tbody>
                                  {% for task_item in all_tasks %}
                                   <tr>
                                      <td>{{task_item.task_user}}</td>
                                       <td>{{task_item.task_role}}</td>
                                       {% if task_item.task_status == 'A' %}
                                       <td><p class="badge badge-dark">아직 시작되지 않음</p></td>
                                       {% endif %}
                                       {% if task_item.task_status == 'B' %}
                                       <td><p class="badge badge-primary">현재 진행중</p> </td>
                                       {% endif %}
                                       {% if task_item.task_status == 'C' %}
                                       <td><p class="badge badge-success">완료</p></td>
                                       {% endif %}
                                       {% if task_item.task_status == 'D' %}
                                       <td><p class="badge badge-info">파일 업로드 완료</p></td>
                                       {% endif %}
                                       {% if task_item.task_status == 'E' %}
                                       <td><p class="badge badge-warning">진행 중단</p></td>
                                       {% endif %}
                                       {% if task_item.task_status == 'F' %}
                                       <td><p class="badge badge-danger">취소</p></td>
                                       {% endif %}
                                       <td >
                                          {{task_item.task_dead}}
                                        </td>
                                       <td>
                                          <span> {{task_item.task_percent}} % </span>
                                         <div class="progress">

                                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-cyan" role="progressbar" style="width: {{task_item.task_percent}}%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                       </td>

                                       {% if task_item.task_user == user %}
                                        <td>
                                            <button type="submit" class="btn btn-primary btn-sm">업데이트 / 신용 크레딧 받기</button>
                                        </td>
                                       {% endif %}
                                   </tr>

                                     {% endfor %}
                               </tbody>
                           </table>
                       </div>
                     </div>
                       {% endif %}
                        <!-- ============================================================== -->
                        <!-- 업로드 부분 시작 -->
                        <!-- ============================================================== -->
                            {% if group %}
                              <div class="col-md-6">
                                 <div class="card">
                                     <div class="card-body" style="height:200px;">
                                         <h5 id="ctitle" class="card-title">파일을 끌어오세요</h5>

                                           <form id="upload" action="/main/box/{{user}}/{{group}}/{{team}}/uploadto/" method="POST" enctype="multipart/form-data">
                                                 {% csrf_token %}
                                                    <p>파일을 끌어 오세요.</p>
                                             <fieldset>
                                               <div class="files">
                                                 <input id="fileselect" type="file" name="myfile" class="addFile"/>
                                               </div>
                                               <div id="submitbutton">
                                                 <button class="btn btn-primary btn-sm" type="submit">업로드</button>
                                               </div>
                                             </fieldset>
                                           </form>

                                         </p>
                                     </div>
                                 </div>
                             </div>
                             <div class="col-md-6">
                                 <div class="card">
                                     <div class="card-body">
                                         <h5 class="card-title">파일을 선택하여 업로드합니다.</h5>
                                         {% load static %}

                                         <p>
                                            <form id="choo" method="post" action="/main/box/{{user}}/{{group}}/{{team}}/uploadto/" enctype="multipart/form-data">
                                              {% csrf_token %}

                                                <div class="col-md-9">
                                                    <div class="custom-file">
                                                        <input type="file" name="myfile" class="custom-file-input" required>
                                                        <label class="custom-file-label" >파일을 선택하여 업로드합니다.</label>

                                                    </div>

                                                      <button class="btn btn-primary btn-sm" style="margin-top:-60px;margin-left:400px;" type="submit">업로드</button>
                                                </div>


                                            </form>
                                            </p>
                                 </div>
                             </div>
                             </div>
                             <!-- ============================================================== -->
                             <!-- 업로드 부분 끝 -->
                             <!-- ============================================================== -->
                          {% endif %}

                             <div class="col-md-8">
                               <div class="card">
                                 <div class="card-body">
                                  <h4 class="card-title m-b-0">공유된 파일{{querys1}}</h4>
                                 </div>
                            <div class="comment-widgets scrollable">
                                    {% for file_item in all_file_items %}
                               <div class="d-flex flex-row comment-row">
                                   <div class="p-2"><img src="/static/assets/images/big/auth-bg.jpg" alt="user" width="50" class="rounded-circle"></div>
                                   <div class="comment-text w-100">

                                       <h6 class="font-medium">{{ file_item.file_name }} · {{ file_item.file_size }} MB</h6>
                                       <span class="m-b-15 d-block">#{{ file_item.user_name }} · {{ file_item.assignment_title }} 제출 · 서명 </span>

                                       <div class="comment-footer">

                                           <span class="text-muted float-right"> {{ file_item.team_title }} · {{file_item.uploaded_date}} · {{ file_item.class_name }}</span>
                                           <br>
                                           <a href="/main{{file_item.document}}" target="_blank" class="btn btn-cyan btn-sm">문서 보기</a>
                                           <a href="/main{{file_item.document}}" download style="color:white;" class="btn btn-success btn-sm">다운로드</a>

                                           {% if file_item.user_name == user %}
                                           <form method="post" action="/main/box/{{ user }}/delete/" >
                                             {% csrf_token %}
                                             <input type="hidden" name="del" value="{{ file_item.id }}" />
                                             <button type="submit" class="btn btn-danger btn-sm" style="margin-left:130px;margin-top:-52px;">삭제</button>
                                           </form>
                                           {% endif %}
                                          {% if not file_item.user_name == user %}
                                        <!--     <form method="post" action="/main/box/{{user}}/score/{{ file_item.user_name }}/{{ file_item.file_name }}/">
                                           <p id="result" style="margin-top:10px;">같은 팀원의 문서를 평가해주세요.(별 1개 = 1점)</p>
                                                    {% csrf_token %}
                                               <p class="star_rating" style="margin-top:-15px;">
                                                      <a href="#">★</a>
                                                      <a href="#">★</a>
                                                      <a href="#">★</a>
                                                      <a href="#">★</a>
                                                      <a href="#">★</a>
                                                  </p> -->
                                                 <a href="/main/box/{{user}}/{{group}}/{{team}}/score/{{ file_item.user_name }}/{{ file_item.file_name }}/" style="display:inline;" class="btn btn-primary btn-sm">팀원의 문서를 평가하기</a>
                                              <!--   </form> -->

                                          {% endif %}


                                       </div>
                                   </div>
                               </div>

                                 {% endfor %}
<!--
                                 {% if group %}


                                         <a href="" class="btn btn-dark btn-sm" data-toggle="modal" data-target="#exampleModal" style="margin-top:10px;margin-bottom:10px;">다른 팀원 평가보기</a>


                                                     <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                       <div class="modal-dialog" role="document">
                                                         <div class="modal-content">
                                                           <div class="modal-header">
                                                             <h5 class="modal-title" id="exampleModalLabel" style="color:black;"> {{ file_item.user_name }} 팀원이 업로드 한 {{ file_item.file_name }} 의<br> 팀원들의 의견입니다. (익명으로 처리)</h5>
                                                             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                               <span aria-hidden="true">&times;</span>
                                                             </button>
                                                           </div>
                                                           <div class="modal-body">

                                                           </div>
                                                           <div class="modal-footer">

                                                             <button type="button" class="btn btn-dark btn-sm" data-dismiss="modal">확인</button>
                                                           </div>
                                                         </div>
                                                       </div>
                                                     </div>

                                 {% endif %}    -->


                           </div>
                       </div>
                        </div>


                        <div class="col-md-4">
                                                <div class="card">
                                                    <div class="card-body" style="font-size:13px;">
                                                        <h5 class="card-title">현재 수강중인 과목</h5>

                                                        <div class="card"><!-- table start -->
                                                                 <div class="card-body">
                                                                     <p class="card-title">과목 선택후 파일 업로드가 가능합니다.</p>
                                                                 </div>
                                                                 <table class="table">
                                                                   <thead>
                                                                     <tr>
                                                                       <th scope="col">#</th>
                                                                       <th scope="col">수강 과목</th>
                                                                       <th scope="col">팀 이름</th>

                                                                     </tr>
                                                                   </thead>
                                                                   <tbody>
                                                                       {% for group_item in all_groups %}

                                                                       <tr style="color:white;">
                                                                         <th scope="row"><a class="btn btn-dark btn-sm" href="/main/box/{{user}}/{{ group_item.subject_name }}/{{ group_item.team_num_id }}/">{{ group_item.num }}</a></th>
                                                                         <td><a class="btn btn-primary btn-sm"  href="/main/box/{{user}}/{{ group_item.subject_name }}/{{ group_item.team_num_id }}/">{{ group_item.subject_name }}</a> </td>
                                                                         <td><a class="btn btn-success btn-sm" href="/main/box/{{user}}/{{ group_item.subject_name }}/{{ group_item.team_num_id }}/">{{ group_item.team_num_id }}조</a></td>

                                                                       </tr>
                                                                       {% endfor %}

                                                                   </tbody>
                                                                 </table>
                                                             </div> <!-- table end -->
                                                    </div>
                                                </div>
                        </div> <!-- col end -->
                          <!-- review list start -->

                    </div>

                    {% if not group %}

        {% if not group %}

                <div class="row">
                     <div class="col-md-6">
                        <div class="card">
                           <div class="card-body">
                               <h4 class="card-title m-b-0">최근 작성한 문서 평가</h4>
                           </div>

                           <ul class="list-style-none">
                             {% for review_item in all_reviews %}
                               <li class="d-flex no-block card-body">
                                   <i class="fa fa-check-circle w-30px m-t-5"></i>
                                   <div>
                                       <p class="m-b-0 font-medium p-0" style="margin-top:-3px;">{{review_item.review_file}}*{{review_item.review_subject}} - {{review_item.review_team}}</p>
                                       <span class="text-muted">{{review_item.review_comments}}</span>
                                   </div>
                                   <div class="ml-auto">
                                       <div class="tetx-right">

                                           <span class="text-muted font-16">{{review_item.review_date}}</span>
                                       </div>
                                   </div>
                               </li>



                                {% endfor %}
                           </ul>


                       </div>
                   </div>


                 <div class="col-md-6">
                       <!-- Card -->
                       <div class="card">
                           <div class="card-body">
                               <h4 class="card-title">신용 크레딧 기록  <p class="badge badge-dark" style="margin-top:0px;margin-left:20px;">현재 신용 크레딧 100</p>
                                 <p class="badge badge-dark" style="margin-top:0px;">나의 크레딧 발급 주소 : 18cBEMRxXHqzWWCxZNtU91F5sbUNKhL5PX </p></h4>
                               <div class="chat-box scrollable" style="height:475px;">
                                   <!--chat Row -->
                                   <ul class="chat-list">
                                       <!--chat Row -->


                                       <li class="chat-item">
                                           <div class="chat-img"><img src="/static/assets/images/big/img5.jpg" alt="user" style="width:50px;height:50px;"></div>
                                           <div class="chat-content">
                                               <h6 class="font-medium">협업관리시스템</h6>
                                               <div class="box bg-light-info">협업관리시스템으로부터 크레딧이 도착했습니다.<br>발신자 주소: 1C6uJF13HZcdr216r34y6tKXJcsCsXSQtN <br> 수신자 발급주소: 18cBEMRxXHqzWWCxZNtU91F5sbUNKhL5PX <br>
                                                 <크레딧 적용 내용..> <br> 도착한 크레딧 : 26 credit <br> 현재 신용 크레딧 합계: 126 credit </div>
                                           </div>
                                           <div class="chat-time">10:56 am</div>
                                       </li>
                                       <!--chat Row -->

                                       <!--chat Row -->
                                   </ul>
                               </div>
                           </div>

                       </div>
                </div> <!-- row end -->

                  {% endif %}


             {% endif %}

                <footer class="footer text-center">
                    Copyright &copy 2019. Developed by <a href="http://www.sejong.ac.kr">Sejong University</a>.
                </footer>


{% endblock %}
